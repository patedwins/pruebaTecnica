FROM alpine/helm:3.8.2
LABEL mantainer="patedwins@gmail.com"
WORKDIR /app
COPY /ci/helm .

ARG CICD_PASS_ARG
ARG CICD_USER_ARG

ARG SVR_DEPLOY_PWD_PRE_ARG
ARG SVR_DEPLOY_USR_PRE_ARG

ENV CICD_PASS=$CICD_PASS_ARG
ENV CICD_USER=$CICD_USER_ARG

ENV SVR_DEPLOY_PWD_PRE=$SVR_DEPLOY_PWD_PRE_ARG
ENV SVR_DEPLOY_USR_PRE=$SVR_DEPLOY_USR_PRE_ARG

RUN apk add git curl openssl bash --no-cache
RUN helm dependency update .
RUN helm package .
RUN chmod -R 777 /root/.local/share/helm/plugins/helm-nexus-push.git/push.sh
RUN helm nexus-push . . -u $SVR_DEPLOY_USR_PRE -p $SVR_DEPLOY_PWD_PRE